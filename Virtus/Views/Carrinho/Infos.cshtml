@model Carrinho
@{
    var enderecos = ViewBag.Enderecos as List<Endereco> ?? new List<Endereco>();
    decimal? taxaEntrega = ViewBag.TaxaEntrega as decimal?;
    decimal? subtotal = ViewBag.Subtotal as decimal?;
    decimal? total = ViewBag.Total as decimal?;
    string pix = ViewBag.Pix;
    var novoEndereco = ViewBag.NovoEndereco as Endereco ?? new Endereco();
}

<div class="container my-4">
    <h3 class="fw-bold mb-4">Frete e pagamento</h3>

    <div class="row">
        <!-- Coluna esquerda -->
        <div class="col-md-8">
            <!-- Endereço -->
            <div class="border rounded-3 mb-4 p-3 bg-light">
                <h6 class="fw-bold">Endereço de Entrega</h6>

                @if (enderecos.Count > 0)
                {
                    int index = 0;
                    foreach (var endereco in enderecos)
                    {
                        <div class="form-check mb-2">
                            <input class="form-check-input"
                                   type="radio"
                                   name="EnderecoSelecionado"
                                   value="@endereco.Id"
                                   id="endereco_@endereco.Id"
                                   @(index == 0 ? "checked" : "")>
                            <label class="form-check-label" for="endereco_@endereco.Id">
                                @($"{endereco.NomeCompleto}: {endereco.Logradouro}, {endereco.Numero} - {endereco.Cidade}/{endereco.Estado} - CEP {endereco.CEP}")
                            </label>
                        </div>
                        index++;
                    }

                    <button type="button" class="btn btn-outline-primary mt-2"
                            data-bs-toggle="modal" data-bs-target="#AdicionarEndereco">
                        Adicionar novo endereço
                    </button>
                }
                else
                {
                    <button type="button" class="btn btn-outline-primary"
                            data-bs-toggle="modal" data-bs-target="#AdicionarEndereco">
                        Escolher um endereço
                    </button>
                }
            </div>


            <!-- Pagamento com cartão -->
            <h6 class="fw-bold mt-4 mb-3">Pagar com cartão</h6>
            <div class="border rounded-3 mb-4 p-3">
                <table class="table table-borderless align-middle mb-0">
                    <thead>
                        <tr class="text-muted small">
                            <th>Cartão</th>
                            <th>Nome no cartão</th>
                            <th>Vencimento</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <img src="/img/cartao.png" width="60" alt="Cartão" class="rounded">
                                (Crédito) Mastercard
                            </td>
                            <td>Pedro Henrique</td>
                            <td>08/25</td>
                        </tr>
                    </tbody>
                </table>

                <button class="btn btn-dark mt-3">Adicionar outro cartão</button>
            </div>

            <!-- Pagamento com PIX -->
            <h6 class="fw-bold mt-4 mb-3">Pagar com pix <img src="/img/pix-icon.png" width="18" alt="pix" /></h6>
            <div class="border rounded-3 p-3">
                <div class="p-2">
                    <h6 class="fw-bold">Ganhe 5% de desconto</h6>
                    <p class="small mb-1">1. Após a finalização do pedido, abra o app do seu banco e escolha pagar com Pix.</p>
                    <p class="small mb-1">2. Copie o código Pix ou escaneie o QR Code exibido.</p>
                    <p class="small mb-3">3. Você receberá a confirmação de pagamento por e-mail.</p>

                    <button id="btnPix" class="btn btn-dark w-100">Finalizar compra com Pix</button>
                </div>
            </div>
        </div>

        <!-- Coluna direita -->
        <div class="col-md-4">
            <div class="border rounded-3 p-3 bg-light">
                <h6 class="fw-bold">Resumo do pedido</h6>
                <hr>

                <div class="d-flex justify-content-between">
                    <span>Subtotal:</span>
                    <span id="subtotal">R$ @(ViewBag.Subtotal)</span>
                </div>
                <div class="d-flex justify-content-between">
                    <span>Frete:</span>
                    <span id="frete">@(ViewBag.TaxaEntrega)</span>
                </div>
                <hr>
                <div class="d-flex justify-content-between fw-bold">
                    <span>Valor total:</span>
                    <span id="total">R$ @(ViewBag.Total)</span>
                </div>

                <small class="text-muted">
                    ou R$ <span id="pixPrice">@(ViewBag.Pix)</span> no pix com desconto de 5%
                </small>

                <button class="btn btn-dark w-100 mt-3">Usar esse método de pagamento</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para adicionar endereço -->
<!-- Modal para adicionar endereço -->
<div class="modal fade" id="AdicionarEndereco" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5">Adicionar Endereço</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>

            <div class="modal-body">
                <form asp-action="SalvarEndereco" method="post">
                    <input type="hidden" name="Id" value="@novoEndereco.Id" />

                    <div class="row mb-2">
                        <label class="col-sm-4 col-form-label">Nome Completo</label>
                        <div class="col-sm-8">
                            <input class="form-control" name="NomeCompleto" value="@novoEndereco.NomeCompleto" />
                        </div>
                    </div>

                    <div class="row mb-2">
                        <label class="col-sm-4 col-form-label">Logradouro</label>
                        <div class="col-sm-8">
                            <input class="form-control" name="Logradouro" value="@novoEndereco.Logradouro" />
                        </div>
                    </div>

                    <div class="row mb-2">
                        <label class="col-sm-4 col-form-label">Número</label>
                        <div class="col-sm-8">
                            <input class="form-control" name="Numero" value="@novoEndereco.Numero" />
                        </div>
                    </div>

                    <div class="row mb-2">
                        <label class="col-sm-4 col-form-label">Bairro</label>
                        <div class="col-sm-8">
                            <input class="form-control" name="Bairro" value="@novoEndereco.Bairro" />
                        </div>
                    </div>

                    <div class="row mb-2">
                        <label class="col-sm-4 col-form-label">Cidade</label>
                        <div class="col-sm-8">
                            <input class="form-control" name="Cidade" value="@novoEndereco.Cidade" />
                        </div>
                    </div>

                    <div class="row mb-2">
                        <label class="col-sm-4 col-form-label">Estado</label>
                        <div class="col-sm-8">
                            <input class="form-control" name="Estado" value="@novoEndereco.Estado" />
                        </div>
                    </div>

                    <div class="row mb-2">
                        <label class="col-sm-4 col-form-label">CEP</label>
                        <div class="col-sm-8">
                            <input class="form-control" name="CEP" value="@novoEndereco.CEP" />
                        </div>
                    </div>

                    <div class="row mb-2">
                        <label class="col-sm-4 col-form-label">Complemento</label>
                        <div class="col-sm-8">
                            <input class="form-control" name="Complemento" value="@novoEndereco.Complemento" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="offset-sm-4 col-sm-8">
                            <button type="submit" class="btn btn-primary">Salvar</button>
                        </div>
                    </div>
                </form>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>
