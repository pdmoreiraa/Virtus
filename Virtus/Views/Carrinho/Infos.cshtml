@model Virtus.Models.Carrinho

<div class="container my-4">
    <h3 class="fw-bold mb-4">Frete e pagamento</h3>

    <div class="row">
        <!-- Coluna esquerda -->
        <div class="col-md-8">
            <!-- Endereço -->
            <div class="border rounded-3 mb-4 p-3 bg-light">
                <h6 class="fw-bold">Endereço de Entrega</h6>

                @if (Model.Enderecos.Count > 0)
                {
                    int index = 0;
                    foreach (var endereco in Model.Enderecos)
                    {
                        <div class="form-check mb-2">
                            <input class="form-check-input"
                                   type="radio"
                                   name="EnderecoSelecionado"
                                   value="@endereco.Id"
                                   id="endereco_@endereco.Id"
                                   @(index == 0 ? "checked" : "")>
                            <label class="form-check-label" for="endereco_@endereco.Id">
                                @($"{endereco.NomeCompleto}: {endereco.Logradouro}, {endereco.Numero} - {endereco.Cidade}/{endereco.Estado} - CEP {endereco.CEP}")
                            </label>
                        </div>
                        index++;
                    }

                    <button type="button" class="btn btn-outline-primary mt-2"
                            data-bs-toggle="modal" data-bs-target="#AdicionarEndereco">
                        Adicionar novo endereço
                    </button>
                }
                else
                {
                    <button type="button" class="btn btn-outline-primary"
                            data-bs-toggle="modal" data-bs-target="#AdicionarEndereco">
                        Escolher um endereço
                    </button>
                }
            </div>


            <!-- Pagamento com cartão -->
            <h6 class="fw-bold mt-4 mb-3">Pagar com cartão</h6>
            <div class="border rounded-3 mb-4 p-3 bg-light">
                <table class="table table-borderless align-middle mb-0">
                    <thead>
                        <tr class="text-muted small">
                            <th>Selecionar</th>
                            <th>Bandeira</th>
                            <th>Nome no cartão</th>
                            <th>Vencimento</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.Cartoes != null && Model.Cartoes.Any())
                        {
                            for (int i = 0; i < Model.Cartoes.Count; i++)
                            {
                                var cartao = Model.Cartoes[i];
                                <tr>
                                    <td>
                                        <input class="form-check-input" type="radio" name="CartaoSelecionado" value="@cartao.Id" id="cartao_@cartao.Id" />
                                    </td>
                                    <td>
                                        <img src="/img/cartao.png" width="60" alt="Cartão" class="rounded" />
                                        @($" ({cartao.Tipo}) {cartao.Bandeira}")
                                    </td>
                                    <td>@cartao.NomeTitular</td>
                                    <td>@cartao.Validade</td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="4" class="text-muted">Nenhum cartão cadastrado.</td>
                            </tr>
                        }
                    </tbody>
                </table>

                <button class="btn btn-dark mt-3" data-bs-toggle="modal" data-bs-target="#AdicionarCartao">
                    Adicionar outro cartão
                </button>
            </div>


            <!-- Pagamento com PIX -->
            <h6 class="fw-bold mt-4 mb-3">
                <input class="form-check-input me-2" type="radio" name="MetodoPagamento" id="pixRadio" value="Pix" checked>
                Pagar com Pix <img src="/img/pix-icon.png" width="18" alt="pix" />
            </h6>
            <div class="border rounded-3 p-3">
                <div class="p-2">
                    <h6 class="fw-bold">Ganhe 5% de desconto</h6>
                    <p class="small mb-1">1. Após a finalização do pedido, abra o app do seu banco e escolha pagar com Pix.</p>
                    <p class="small mb-1">2. Copie o código Pix ou escaneie o QR Code exibido.</p>
                    <p class="small mb-3">3. Você receberá a confirmação de pagamento por e-mail.</p>

                    <button id="btnPix" class="btn btn-dark w-100">Finalizar compra com Pix</button>
                </div>
            </div>


        <!-- Coluna direita -->
        <div class="col-md-4">
            <div class="border rounded-3 p-3 bg-light">
                <h6 class="fw-bold">Resumo do pedido</h6>
                <hr>

                <div class="d-flex justify-content-between">
                    <span>Subtotal:</span>
                    <span id="subtotal">R$ @Model.Subtotal.ToString("F2")</span>
                </div>
                <div class="d-flex justify-content-between">
                    <span>Frete:</span>
                    <span id="frete">R$ @Model.TaxaEntrega.ToString("F2")</span>
                </div>
                <hr>
                <div class="d-flex justify-content-between fw-bold">
                    <span>Valor total:</span>
                    <span id="total">R$ @Model.Total.ToString("F2")</span>
                </div>

                <small class="text-muted">
                    ou R$ <span id="pixPrice">@Model.Pix.ToString("F2")</span> no pix com desconto de 5%
                </small>

                <button class="btn btn-dark w-100 mt-3">Usar esse método de pagamento</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para adicionar endereço -->
<div class="modal fade" id="AdicionarEndereco" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5">Adicionar Endereço</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>

            <div class="modal-body">
                <form asp-action="SalvarEndereco" method="post">
                    <input type="hidden" name="Id" value="@Model.NovoEndereco.Id" />

                    <div class="row mb-2">
                        <label class="col-sm-4 col-form-label">Nome Completo</label>
                        <div class="col-sm-8">
                            <input class="form-control" name="NomeCompleto" value="@Model.NovoEndereco.NomeCompleto" />
                        </div>
                    </div>

                    <div class="row mb-2">
                        <label class="col-sm-4 col-form-label">Logradouro</label>
                        <div class="col-sm-8">
                            <input class="form-control" name="Logradouro" value="@Model.NovoEndereco.Logradouro" />
                        </div>
                    </div>

                    <div class="row mb-2">
                        <label class="col-sm-4 col-form-label">Número</label>
                        <div class="col-sm-8">
                            <input class="form-control" name="Numero" value="@Model.NovoEndereco.Numero" />
                        </div>
                    </div>

                    <div class="row mb-2">
                        <label class="col-sm-4 col-form-label">Bairro</label>
                        <div class="col-sm-8">
                            <input class="form-control" name="Bairro" value="@Model.NovoEndereco.Bairro" />
                        </div>
                    </div>

                    <div class="row mb-2">
                        <label class="col-sm-4 col-form-label">Cidade</label>
                        <div class="col-sm-8">
                            <input class="form-control" name="Cidade" value="@Model.NovoEndereco.Cidade" />
                        </div>
                    </div>

                    <div class="row mb-2">
                        <label class="col-sm-4 col-form-label">Estado</label>
                        <div class="col-sm-8">
                            <input class="form-control" name="Estado" value="@Model.NovoEndereco.Estado" />
                        </div>
                    </div>

                    <div class="row mb-2">
                        <label class="col-sm-4 col-form-label">CEP</label>
                        <div class="col-sm-8">
                            <input class="form-control" name="CEP" value="@Model.NovoEndereco.CEP" />
                        </div>
                    </div>

                    <div class="row mb-2">
                        <label class="col-sm-4 col-form-label">Complemento</label>
                        <div class="col-sm-8">
                            <input class="form-control" name="Complemento" value="@Model.NovoEndereco.Complemento" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="offset-sm-4 col-sm-8">
                            <button type="submit" class="btn btn-primary">Salvar</button>
                        </div>
                    </div>
                </form>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>


<!-- Modal para adicionar cartão -->
<div class="modal fade" id="AdicionarCartao" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5">Adicionar Cartão</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>

            <div class="modal-body">
                <form asp-action="SalvarCartao" method="post">
                    <div class="mb-3">
                        <label class="form-label">Tipo</label>
                        <select name="Tipo" class="form-select" value="@Model.NovoCartao.Tipo" required>
                            <option value="">Selecione...</option>
                            <option>Crédito</option>
                            <option>Débito</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Nome no cartão</label>
                        <input type="text" name="NomeTitular" class="form-control" value="@Model.NovoCartao.NomeTitular" required  />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Número do cartão</label>
                        <input type="text" name="Numero" maxlength="16" class="form-control" value="@Model.NovoCartao.Numero" required />
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Validade (MM/AA)</label>
                            <input type="text" name="Validade" maxlength="5" class="form-control" placeholder="MM/AA" value="@Model.NovoCartao.Validade" required />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">CVV</label>
                            <input type="text" name="CVV" maxlength="3" class="form-control" value="@Model.NovoCartao.CVV" required />
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Bandeira</label>
                        <select name="Bandeira" class="form-select" value="@Model.NovoCartao.Bandeira" required>
                            <option value="">Selecione...</option>
                            <option>Mastercard</option>
                            <option>Visa</option>
                            <option>Elo</option>
                            <option>Hipercard</option>
                        </select>
                    </div>

                    <div class="text-end">
                        <button type="submit" class="btn btn-primary">Salvar cartão</button>
                    </div>
                </form>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>
