@model Virtus.Models.Produto

<div class="row">
    <div class="col-md-8 mx-auto rounded border p-3">
        <h2 class="text-center mb-5">Novo Produto</h2>


        <form asp-action="Criar" asp-controller="Produto" method="post" enctype="multipart/form-data">
            <div class="row mb-3">
                <label class="col-sm-4 col-form-label">Nome</label>
                <div class="col-sm-8">
                    <input class="form-control" asp-for="PrdNome">
                    <span asp-validation-for="PrdNome" class="text-danger"></span>
                </div>
            </div>

            <div class="row mb-3">
                <label class="col-sm-4 col-form-label">Marca</label>
                <div class="col-sm-8">
                    <select class="form-select" asp-for="PrdMarca">
                        <option value="">Selecione...</option>
                        <option value='Adidas'>Adidas</option>
                        <option value='Fila'>Fila</option>
                        <option value='Nike'>Nike</option>
                        <option value='Puma'>Puma</option>
                    </select>
                    <span asp-validation-for="PrdMarca" class="text-danger"></span>
                </div>
            </div>

            <div class="row mb-3">
                <label class="col-sm-4 col-form-label">Categoria</label>
                <div class="col-sm-8">
                    <select class="form-select" asp-for="PrdCategoria">
                        <option value="">Selecione...</option>
                        <option value='Masculino'>Masculino</option>
                        <option value='Feminino'>Feminino</option>
                        <option value='Infantil'>Infantil</option>
                        <option value='Unissex'>Unissex</option>
                    </select>
                </div>
            </div>

            <div class="row mb-3">
                <label class="col-sm-4 col-form-label">Tipo</label>
                <div class="col-sm-8">
                    <select id="Tipo" class="form-select" asp-for="PrdTipo">
                        <option value="">Selecione...</option>
                        <option value='Acessório'>Acessório</option>
                        <option value='Agasalho'>Agasalho</option>
                        <option value='Bermuda'>Bermuda</option>
                        <option value='Calça'>Calça</option>
                        <option value='Calçado'>Calçado</option>
                        <option value='Camisa de Time'>Camisa de Time</option>
                        <option value='Camiseta'>Camiseta</option>
                        <option value='Equipamento'>Equipamento</option>
                        <option value='Shorts'>Shorts</option>
                        <option value='Top'>Top</option>
                    </select>
                </div>
            </div>

            <div id="tamanho-div"></div>

            <template id="tamanhos" class="d-none">
            <div class="row mb-3">
                <label class="col-sm-4 col-form-label">Tamanho</label>
                <div class="col-sm-8">
                    <select class="form-select tamanho-select">
                        <option value="">Selecione...</option>
                    </select>
                </div>
            </div>

                <div class="row mb-3">
                    <label class="col-sm-4 col-form-label">Estoque</label>
                    <div class="col-sm-8">
                        <input class="form-control estoque-input" type="number">
                    </div>
                </div>

                <div class="mb-3 d-flex justify-content-end">
                    <button type="button" class="btn btn-danger remover">X</button>
                </div>

            </template>

            <div class="mb-3 d-flex justify-content-end">
            <button type="button" id="Add" class="btn btn-dark smooth-btn">
                Adicionar tamanho e quantidade
            </button>
            </div>

            <div class="row mb-3">
                <label class="col-sm-4 col-form-label">Esporte</label>
                <div class="col-sm-8">
                    <select class="form-select" asp-for="PrdEsporte">
                        <option value="">Selecione...</option>
                        <option value='Corrida'>Corrida</option>
                        <option value='Futebol'>Futebol</option>
                        <option value='Vôlei'>Vôlei</option>
                        <option value='Basquete'>Basquete</option>
                    </select>
                </div>
            </div>

            <div class="row mb-3">
                <label class="col-sm-4 col-form-label">Preço (R$)</label>
                <div class="col-sm-8">
                    <input asp-for="PrdPreco" class="form-control" id="Preco" type="text" placeholder="0,00" />
                    <span asp-validation-for="PrdPreco" class="text-danger"></span>
                </div>
            </div>

            <div class="row mb-3">
                <label class="col-sm-4 col-form-label">Descrição</label>
                <div class="col-sm-8">
                    <textarea class="form-control" asp-for="PrdDescricao"></textarea>
                    <span asp-validation-for="PrdDescricao" class="text-danger"></span>
                </div>
            </div>

            <div class="row mb-3">
                <label class="col-sm-4 col-form-label">Imagem</label>
                <div class="col-sm-8">
                    <input type="file" class="form-control" name="imagensArquivo" multiple accept="image/*">

                    <span asp-validation-for="Imagens" class="text-danger"></span>

                </div>
            </div>

            <div class="row mb-3">
                <label class="col-sm-4 col-form-label">Cor</label>
                <div class="col-sm-8">
                    <input class="form-control" asp-for="PrdCor">
                    <span asp-validation-for="PrdCor" class="text-danger"></span>
                </div>
            </div>

            <div class="row">
                <div class="offset-sm-4 col-sm-4 d-grid">
                    <button type="submit" class="btn btn-dark w-100 mt-3 smooth-btn">Salvar</button>
                </div>
                <div class="col-sm-4 d-grid">
                    <a class="btn btn-light border border-dark rounded w-100 mt-3 smooth-btn" asp-controller="Produto" asp-action="Index" role="button">
                        Cancel
                    </a>
                </div>
            </div>

        </form>
    </div>
</div>

@section Scripts {
    <script>
                document.addEventListener("DOMContentLoaded", function () {
            const precoInput = document.getElementById("Preco");

            // Valor inicial formatado
            if (!precoInput.value) {
                precoInput.value = "0,00";
            }

            precoInput.addEventListener("input", function (e) {
                let value = e.target.value;

                // Remove tudo que não for número
                value = value.replace(/\D/g, "");

                // Se vazio, assume 0
                if (value === "") {
                    value = "0";
                }

                // Converte para centavos e insere a vírgula
                value = (parseInt(value) / 100).toFixed(2);

                // Substitui ponto por vírgula
                value = value.replace(".", ",");

                e.target.value = value;
            });

            // Garante o formato correto ao perder o foco
            precoInput.addEventListener("blur", function (e) {
                if (e.target.value === "" || e.target.value === "0") {
                    e.target.value = "0,00";
                }
            });
        });


        let index = 0;

        const tamCalcado = ["36","37","38","39","40","41","42"];
        const tamAcessorio = ["Único"];
        const tamRoupa = ["P","M","G","GG"];

        document.getElementById("Add").addEventListener("click", () => {

            const tipos = document.getElementById("Tipo").value;

            let opcoes = [];
            if (tipos === "Calçado") opcoes = tamCalcado;
            else if (tipos === "Acessório") opcoes = tamAcessorio;
            else opcoes = tamRoupa;

            // clona template
            const tamanhos = document.getElementById("tamanhos");
            const clone = tamanhos.content.cloneNode(true);

            const select = clone.querySelector(".tamanho-select");
            const input = clone.querySelector(".estoque-input");

            // preenche tamanhos
            opcoes.forEach(t => {
                const o = document.createElement("option");
                o.value = t;
                o.textContent = t;
                select.appendChild(o);
            });

            // define names corretos para subir ao backend
            select.name = `Estoques[${index}].EstTamanho`;
            input.name  = `Estoques[${index}].EstQuantidade`;

            index++;

            document.getElementById("tamanho-div").appendChild(clone);
        });
    </script>
}
